<div class="container-fluid">
  @if ( (advertisementService.advertisements$ | async)?.items) {
  <div class="row">
    <div class="col-6 d-flex justify-content-start ps-0">
      <app-adv-list-filter
        *ngIf="selectedListType !== advListType.MyAdvertisements"
        (onChanged)="sortChanged($event)"
        [disabled]="busyService.isLoading()"
        [isAdvertisementList]="true"
      ></app-adv-list-filter>
    </div>

    <div class="col-6 d-flex justify-content-end">
      <div
        *ngIf="
          (advertisementService.advertisements$ | async)?.pagination &&
          ((advertisementService.advertisements$ | async)?.pagination)!
            .totalItems > 0 &&
          ((advertisementService.advertisements$ | async)?.pagination)!
            .totalItems >
            ((advertisementService.advertisements$ | async)?.pagination)!
              .itemsPerPage
        "
      >
        <paginator-localization
          [disabled]="busyService.isLoading()"
          #paginator
          (page)="handlePageEvent($event)"
          [length]="
            (advertisementService.advertisements$ | async)?.pagination
              ?.totalItems ?? 0
          "
          [pageSize]="
            (advertisementService.advertisements$ | async)?.pagination
              ?.itemsPerPage ?? 0
          "
          [pageIndex]="
            (advertisementService.advertisements$ | async)?.pagination
              ?.currentPage ?? 0
          "
        ></paginator-localization>
      </div>
    </div>
  </div>
  }
  <!-- BUTTONS -->
  <!-- MyAdvertisements -->
  <div
    *ngIf="
      selectedListType === advListType.MyAdvertisements &&
      (advertisementService.advertisements$ | async)?.items
    "
  >
    <div class="d-flex mt-2">
      <div class="col-6 d-flex align-items-center justify-content-center">
        <button class="btn empty-button" (click)="openPrivateHistory()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24px"
            viewBox="0 -960 960 960"
            width="24px"
            fill="#5f6368"
          >
            <path
              d="m630-310 20-20-156-156.02V-680h-28v206l164 164ZM480.17-132q-72.17 0-135.73-27.39-63.56-27.39-110.57-74.35-47.02-46.96-74.44-110.43Q132-407.65 132-479.83q0-72.17 27.39-135.73 27.39-63.56 74.35-110.57 46.96-47.02 110.43-74.44Q407.65-828 479.83-828q72.17 0 135.73 27.39 63.56 27.39 110.57 74.35 47.02 46.96 74.44 110.43Q828-552.35 828-480.17q0 72.17-27.39 135.73-27.39 63.56-74.35 110.57-46.96 47.02-110.43 74.44Q552.35-132 480.17-132ZM480-480Zm0 320q133 0 226.5-93.5T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 133 93.5 226.5T480-160Z"
            />
          </svg>
          <div class="text-muted">История</div>
        </button>
      </div>
      <div
        class="col-6 d-flex flex-column align-items-center justify-content-center"
      >
        <button
          class="btn empty-button"
          (click)="create()"
          [disabled]="
            ((advertisementService.advertisements$ | async)?.items)!.length > 2
          "
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="24px"
            viewBox="0 -960 960 960"
            width="24px"
            fill="#5f6368"
          >
            <path
              d="M466-306h28v-160h160v-28H494v-160h-28v160H306v28h160v160Zm14.17 174q-72.17 0-135.73-27.39-63.56-27.39-110.57-74.35-47.02-46.96-74.44-110.43Q132-407.65 132-479.83q0-72.17 27.39-135.73 27.39-63.56 74.35-110.57 46.96-47.02 110.43-74.44Q407.65-828 479.83-828q72.17 0 135.73 27.39 63.56 27.39 110.57 74.35 47.02 46.96 74.44 110.43Q828-552.35 828-480.17q0 72.17-27.39 135.73-27.39 63.56-74.35 110.57-46.96 47.02-110.43 74.44Q552.35-132 480.17-132Zm-.17-28q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"
            />
          </svg>

          <div class="text-muted">Создать</div>
          <div
            *ngIf="
              ((advertisementService.advertisements$ | async)?.items)!.length >
              2
            "
            class="my-info-text text-danger"
          >
            Максимум 3 объявления
          </div>
        </button>
      </div>
    </div>
  </div>
  <div class="d-flex flex-column align-items-center">
    <hr class="mb-0 pb-0" style="width: 100%" />
    <div class="mt-0 pt-0 my-info-text text-muted">{{ getListName() }}</div>
  </div>
  <ng-template
    [skeleton]="busyService.isLoading()"
    [skeletonRepeat]="5"
    [skeletonClassName]="'mb-1'"
    [skeletonHeight]="'4rem'"
  >
    @if ( (advertisementService.advertisements$ | async)?.items) {

    <div
      *ngIf="
        ((advertisementService.advertisements$ | async)?.items)!.length === 0
      "
    >
      <app-empty-list-placeholder></app-empty-list-placeholder>
    </div>

    <!-- Pending validation -->
    <div
      *ngIf="
        (advertisementService.advertisements$ | async)?.items &&
        ((advertisementService.advertisements$ | async)?.items)!.length > 0 &&
        selectedListType === advListType.PendingValidation
      "
    >
      <ul class="list-group list-group-flush">
        <li
          *ngFor="
            let advertisement of (advertisementService.advertisements$ | async)
              ?.items
          "
          class="list-group-item"
          [routerLink]="['/app-advertisement-validate', advertisement.id]"
        >
          <div class="d-flex">
            <div class="d-flex flex-column col-11">
              <h6 class="mb-0">{{ advertisement.title }}</h6>
              <div class="fw-normal">
                {{ getUserDisplayName(advertisement) }}
              </div>
              <div class="text-muted my-info-text">
                Поступил:
                {{ dateHelper.getLocalTime(advertisement.updated) }}
              </div>
            </div>
            <div
              class="d-flex fw-normal col-1 align-items-center justify-content-end"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                height="24px"
                viewBox="0 -960 960 960"
                width="24px"
                fill="#5f6368"
              >
                <path
                  d="m320-116-34-34 330-330-330-330 34-34 364 364-364 364Z"
                />
              </svg>
            </div>
          </div>
        </li>
      </ul>
    </div>

    <!-- My advertisements -->
    <div
      *ngIf="
        selectedListType === advListType.MyAdvertisements &&
        (advertisementService.advertisements$ | async)?.items
      "
    >
      <ul class="list-group list-group-flush">
        <li
          *ngFor="
            let advertisement of (advertisementService.advertisements$ | async)
              ?.items
          "
          class="list-group-item"
          [routerLink]="['/app-advertisement-preview', advertisement.id]"
        >
          <div class="d-flex">
            <div class="d-flex flex-column col-11">
              <h6 class="mb-0">{{ advertisement.title }}</h6>
              <div class="fw-normal text-muted">
                {{ getStatus(advertisement) }}
              </div>
              <div class="text-muted my-info-text">
                Создан:
                {{ dateHelper.getLocalTime(advertisement.created) }}
              </div>
            </div>
            <div
              class="d-flex fw-normal col-1 align-items-center justify-content-end"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                height="24px"
                viewBox="0 -960 960 960"
                width="24px"
                fill="#5f6368"
              >
                <path
                  d="m320-116-34-34 330-330-330-330 34-34 364 364-364 364Z"
                />
              </svg>
            </div>
          </div>
        </li>
      </ul>
    </div>
    <!-- AllHistory || PrivateHistory-->
    <div
      *ngIf="
        ((advertisementService.advertisements$ | async)?.items)!.length > 0 &&
        (selectedListType === advListType.AllHistory ||
          selectedListType === advListType.PrivateHistory ||
          selectedListType === advListType.PendingPublication)
      "
    >
      <ul class="list-group list-group-flush">
        <li
          *ngFor="
            let advertisement of (advertisementService.advertisements$ | async)
              ?.items
          "
          class="list-group-item"
          [routerLink]="['/app-advertisement-preview', advertisement.id]"
        >
          <div class="d-flex">
            <div class="d-flex flex-column col-11">
              <h6 class="mb-0">{{ advertisement.title }}</h6>
              <div class="fw-normal text-muted my-info-text">
                <span
                  *ngIf="
                    selectedListType === advListType.AllHistory ||
                      selectedListType === advListType.PrivateHistory;
                    else nextPublishInfo
                  "
                  class="my-info-text"
                  >Размещено:
                </span>
                {{ advertisement.nextPublishDate | date : "dd.MM.yyyy" }}
              </div>
              <div class="text-muted my-info-text">
                {{ getUserDisplayName(advertisement) }}
              </div>
            </div>
            <div
              class="d-flex fw-normal col-1 align-items-center justify-content-end"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                height="24px"
                viewBox="0 -960 960 960"
                width="24px"
                fill="#5f6368"
              >
                <path
                  d="m320-116-34-34 330-330-330-330 34-34 364 364-364 364Z"
                />
              </svg>
            </div>
          </div>
        </li>
      </ul>
    </div>

    <ng-template #nextPublishInfo>
      <span class="my-info-text">Следующее размещение: </span>
    </ng-template>

    }
  </ng-template>
</div>
